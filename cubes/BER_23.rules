FEEDSTRINGS;

SKIPCHECK;


['Provisionsueberschuss_Neugeschaeft']=['1212KSP']+['1213KGP']+['1215BEP']+['12162VPR']+['12164AKE'];
['PRV_SZUE_Neugeschaeft']=['Provisionsueberschuss_Neugeschaeft']+['sonstiger_ZUE_Neugeschaeft'];
['RWA_QUOTE_STICHTAG']=['Stichtagsrisikoaktiva_per_dato']/['Stichtagskreditvolumen_per_dato'];
['RWA_QUOTE_STICHTAG_KSA']=['Stichtagsrisikoaktiva_per_dato_KSA']/['Stichtagskreditvolumen_per_dato'];
['plan_ausserplanmaessige_Tilgungen']=['Stichtagskreditvolumen_per_dato']-['Stichtagskreditvolumen_per_GJ_Anfang']-['Neugeschaeft']-['Bestandsveraenderung_Revolver'];


###### Produktzugehörigkeit ########
['Produktzugehörigkeit']=IF(ELISANC('Produkte','P_261099GR',!Produkte)=1
                           & ELLEV('Produkte',!Produkte)=0
,1
,IF(ELISANC('Produkte','P_262099GR',!Produkte)=1
 & ELLEV('Produkte',!Produkte)=0
,2
,IF(ELISANC('Produkte','P_262000_Übernahmefinanzierung',!Produkte)=1
 & ELLEV('Produkte',!Produkte)=0
,3
,IF(ELISANC('Produkte','P_290273_MA',!Produkte)=1
 & ELLEV('Produkte',!Produkte)=0
,4
,0))));


###### Berechnung der P_NVR_NEU Positionen ##########
['P_NVR_EIGENMITTEL']=['P_262000_Standard_Corporates']-['P_262022']+['P_262000_Projektfinanzierung']+['P_262000_Konsortialfinanzierung']-['P_220290']; 
['P_NVR_FOERDERMITTEL']=['P_261000_Corporates_Foerdermittel']-['P_261013']+['P_261013'];
['P_NVR_IMMO_EIGEN']=['P_262000_Immobilienfinanzierung_Eigenmittel'];
['P_NVR_IMMO_FOERDER']=['P_261011']+['P_261012'];
['P_NVR_SLF']=if (ELISANC( 'Vertrieb', 'A_220300',!Vertrieb )<>0,['P_262000_Übernahmefinanzierung']-['P_262040'],['P_262000_Übernahmefinanzierung']);
['P_NVR_M_A']=['P_BP1_MA'];
['P_NVR_ASSET_FUND_MANAGEMENT']=['P_FM_LONDON'] + ['P_268099GR'];
['P_NVR_TRADE_FINANCE']=['P_262000_Trade_Finance']+['P_262022'];
['P_NVR_ASSET_BASED_LENDING']=['P_262000_Asset_Based_Lending'];
['P_NVR_T3']=if (ELISANC( 'Vertrieb', 'A_220300',!Vertrieb )<>0,['P_262040'],0);
['P_NVR_220290']=['P_220290'];


###### Ist_Marge #########
['Ist_Marge']=if ((ELISANC('Kennzahlen','BER' , !Kennzahlen )=1
                   % ELISANC('Kennzahlen','PRV_SZUE_Nachrichtliche_Kennzahlen' , !Kennzahlen )=1
                   % !Kennzahlen @='Risikovorsorge_Kreditgeschaeft')
& !Kennzahlen @<> 'Zinsueberschuss_Eigenmittel'
& !Kennzahlen @<> 'Zinsueberschuss_Foerdermittel' 
& !Kennzahlen @<> 'Zinsaufwand_Eigenmittel'
& !Kennzahlen @<> 'Zinsertrag_Eigenmittel'
& !Kennzahlen @<> 'Zinsaufwand_Foerdermittel'
& !Kennzahlen @<> 'Zinsertrag_Foerdermittel'
& (['durchschn_Volumen_zinstragendes_Geschaeft_(Mio._EUR)','Ist_EUR']<-1
  %
  ['durchschn_Volumen_zinstragendes_Geschaeft_(Mio._EUR)','Ist_EUR']>1)

,(['Ist_EUR']/['durchschn_Volumen_zinstragendes_Geschaeft_(Mio._EUR)','Ist_EUR'])/  DB('ZZ_Monatsfaktor',!Zeit,'Monatsfaktor')
,
if(!Kennzahlen@='Zinsueberschuss_Eigenmittel',
   (['Ist_EUR']/['durch_Volumen_Eigenmittel','Ist_EUR'])/  DB('ZZ_Monatsfaktor',!Zeit,'Monatsfaktor')
,
if(!Kennzahlen@='Zinsueberschuss_Foerdermittel',
   (['Ist_EUR']/['durch_Volumen_Foerdermittel','Ist_EUR'])/  DB('ZZ_Monatsfaktor',!Zeit,'Monatsfaktor'),0)));
   

###### Übernahme der Stringwerte ########
['Ist_TEUR']=S:DB('BER_23',!Vertrieb,!Produkte,!Zeit,'Ist_EUR',!Freigabe,!Kennzahlen);
['Ist_Marge']=S:DB('BER_23',!Vertrieb,!Produkte,!Zeit,'Ist_EUR',!Freigabe,!Kennzahlen);
['Version']=S:DB('BER_23',!Vertrieb,!Produkte,!Zeit,'Ist_EUR',!Freigabe,!Kennzahlen);



###### Ist_TEUR  ##########
['Ist_TEUR']=if (!Kennzahlen @='RWA_QUOTE_STICHTAG'
                 % ELISANC('Kennzahlen','Parameter' , !Kennzahlen )=1
                 % ELISANC('Kennzahlen','Sonstige_Kennzahlen' , !Kennzahlen )=1
,['Ist_EUR']
,['Ist_EUR']/1000);


######## Ermittlung KEZ_RELEVANT ##########
['KEZ_RELEVANT']= if (ABS(['Deckungsbeitrag_III'])+ABS(['Risikovorsorge_Kreditgeschaeft'])
                     +ABS(['verdiente_Risikokosten'])+ABS(['EK_Kosten_KUKA'])+ABS(['durchschn_Volumen_zinstragendes_Geschaeft_(Mio._EUR)'])
                     +ABS(['Stichtagskreditvolumen_per_dato'])+ABS(['Stichtagskreditvolumen_per_GJ_Anfang'])
                     +ABS(['Neugeschaeft'])+ABS(['Durchschn_Risikoaktiva_per_dato'])<>0,1,0);
                     
                     
####### Umwandlung Produktzugehörigkeit in Text #############                     
['PRODUKTZUGEHOERIGKEIT_TEXT']=s:if (['Produktzugehörigkeit']=1,'Corporate_Foerdermittel',
                               if (['Produktzugehörigkeit']=2,'Corporate_Eigenmittel',
                               if (['Produktzugehörigkeit']=3,'Uebernahmefinanzierungen', 
                               if (['Produktzugehörigkeit']=4,'Derivate',''))));                   


####### Befüllen der Stringelemente (soweit benötigt) auf Kundenebene ##########
['VVS']=s:if((SUBST(!Vertrieb,1,2)@='V_'
         % ATTRS( 'Vertrieb',!Vertrieb,'Typ')@='Vertragsstamm'
         % ATTRS( 'Vertrieb',!Vertrieb,'Typ')@='Kunde')
          & ['KEZ_RELEVANT']=1
        ,ATTRS( 'Vertrieb', !Vertrieb, 'VVS' ),STET);


####### Berechnung ÜBER-/Unterdeckung
['Ueber_Unterdeckung']=['verdiente_Risikokosten']+['Risikovorsorge_Kreditgeschaeft'];


####### Berechnung alternativer Deckungsbeiträge
['Deckungsbeitrag_III_mit_aktuellen_Fundingkosten']=if (['Zinsmarge_mit_aktuellen_Fundingkosten']<>0,['Deckungsbeitrag_III']-['Zinsueberschuss']+['Zinsmarge_mit_aktuellen_Fundingkosten'],['Deckungsbeitrag_III']);
['Deckungsbeitrag_III_Risikovorsorge']=['Deckungsbeitrag_III']-['Standardrisikokosten']+['Risikovorsorge_Kreditgeschaeft'];
['Deckungsbeitrag_II_mit_aktuellen_Fundingkosten']=if (['Zinsmarge_mit_aktuellen_Fundingkosten']<>0,['Deckungsbeitrag_II']-['Zinsueberschuss']+['Zinsmarge_mit_aktuellen_Fundingkosten'],['Deckungsbeitrag_II']);
['Deckungsbeitrag_II_Risikovorsorge']=['Deckungsbeitrag_II']-['Standardrisikokosten']+['Risikovorsorge_Kreditgeschaeft'];
['Deckungsbeitrag_III_mit_aktuellen_Fundingkosten_nach_RV']=if (['Zinsmarge_mit_aktuellen_Fundingkosten']<>0,['Deckungsbeitrag_III']-['Zinsueberschuss']+['Zinsmarge_mit_aktuellen_Fundingkosten']-['Standardrisikokosten']+['Risikovorsorge_Kreditgeschaeft']
                                                            , ['Deckungsbeitrag_III']);
                                                          

FEEDERS;

##### Feeding der P_NVR Elemente, damit die Nullzeilen im Provisionsexport richtig unterdrückt werden ######
['P_262000_Standard_Corporates']=>['P_NVR_EIGENMITTEL'];
['P_262022']=>['P_NVR_EIGENMITTEL'];
['P_262000_Projektfinanzierung']=>['P_NVR_EIGENMITTEL'];
['P_262000_Konsortialfinanzierung']=>['P_NVR_EIGENMITTEL'];
['P_220290']=>['P_NVR_EIGENMITTEL'];
['P_261000_Corporates_Foerdermittel']=>['P_NVR_FOERDERMITTEL'];
['P_261013']=>['P_NVR_FOERDERMITTEL'];
['P_262000_Immobilienfinanzierung_Eigenmittel']=>['P_NVR_IMMO_EIGEN'];
['P_261011']=>['P_NVR_IMMO_FOERDER'];
['P_261012']=>['P_NVR_IMMO_FOERDER'];
['P_262000_Übernahmefinanzierung']=>['P_NVR_SLF'];
['P_262000_Übernahmefinanzierung']=>['P_NVR_SLF'];
['P_262040']=>['P_NVR_SLF'];
['P_BP1_MA']=>['P_NVR_M_A'];
['P_FM_LONDON']=>['P_NVR_ASSET_FUND_MANAGEMENT'];
['P_268099GR']=>['P_NVR_ASSET_FUND_MANAGEMENT'];
['P_262000_Trade_Finance']=>['P_NVR_TRADE_FINANCE'];
['P_262022']=>['P_NVR_TRADE_FINANCE'];
['P_262000_Asset_Based_Lending']=>['P_262000_Asset_Based_Lending'];
['P_262040']=>['P_NVR_T3'];
['P_220290']=>['P_NVR_220290'];



